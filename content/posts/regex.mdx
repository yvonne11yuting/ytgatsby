---
path: "/regex"
date: "2018-11-24"
title: "Regular Expressions"
tags: ["regex", "note", "markdown"]
featuredImage: ../../src/images/cover_coffee.png
---

## grep / egrep / fgrep  文本搜尋工具
* grep - global regular expression print, 全面搜尋正規表達式並印出來
* egrep - grep的擴展
* fgrep - fgrep就是fixed grep或fast grep，它們把所有的字母都看作單詞

## egrep詮釋字元
### 一行的開始與結尾
* ^ - 脫字元, caret, 比對行首開頭
* $ - 錢, dollar, 比對行末結尾

```^cat```
不是：~~會匹配以cat開頭的行~~
而是：要匹配的話，要先有行首，緊接著c，緊接著a，再緊接著t。

### 字元類別
#### 匹配特定幾個字元之一 [ae]
* [...] - 字元類別(character class) / 隱含“或”的意思

```gr[ae]y```
解釋：要找到g，後面跟著r，接著跟著e或a，最後再出現y
* g和r的關係：且接著
* [ea]的關係：或

```<h[123456]>```
解釋：會匹配\<h1\>、\<h2\>、\<h3\>等內容

#### 字元類別詮釋字元(character-class metacharacter) 「0-9A-Za-z」
* \- : 連字號，可用來表示一段字元範圍，只有在字元類別([...])內是解釋成詮釋字元

```<h[123456]>```即等於```<h[1-6]>```
```[0123456789abcdefABCDEF]```即等於```[0-9a-fA-F]```或是```[A-Fa-f0-9]```。
因為範圍之間的```先後順序並不重要```
```[0-9A-Z_!.?]```
解釋：匹配數字、大寫英文字母、底線、驚嘆號、句點或問號

#### 效果反轉的字元類別 [^...]
如果寫成[^...]而不是[...]的話，類別就會匹配任何**沒有**列出的字元
```[^1-6]```
解釋：匹配1到6以外的任何字元

```egrep 'q[^u]' xxx.list```
解釋：q後面跟著一個字元，且這個字元不是u
"Qantas"和"Iraq"不會被匹配到，因為：
1. Qantas的"Q"是大寫
2. Iraq的q後面沒有跟著一個字元，出局！一個字元類別就算反轉了，終究需要一個字元讓它匹配。

### 以句點匹配任何字元 「.」
* 「.」這個詮釋字元(通常稱為dot或point)，是```匹配任何字元```的字元類別的簡寫法。當您想在式子裡放一個"允許任何字元"的地方時，就可以使用它

```03.19.76```
解釋：匹配0，緊接著3，緊接著任何字元，緊接著1，緊接著9，緊接著任何字元，緊接著7，緊接著6
所以說```03.19.76```可能的匹配結果包含```03/19/76```或```03-19.76```或```03319976```
```03[-./]19[-./]76```
這面這個表達式中，「.」就不是詮釋字元，因為他在字元類別([...])內。
解釋：匹配0，緊接著3，接著可能是「-」或「.」或「/」，然後再接著1，接著9，接著可能是「-」或「.」或「/」，再接著可能是7，接著6

### 選項
#### 匹配幾個子表達式之一 (xxx|yyy|kkk)
* | 為詮釋字元，代表"或"，它讓我們能夠將多個表達式結合成單一個表達式。
```Bob|Robert```
解釋：上方表達是一個表達式，不管是Bob或Robert都會匹配。

```gr[ea]y```等於```grey|gray```等於```gr(a|e)y```
**備註：**千萬不要混在一起！
* "()"小括號是詮釋字元
* "[...]"中括號是字元類別，如果"|"在字元類別中出現，則只是普通字元，沒有特殊意義

```(Geoff|Jeff)(rey|ery)```等於```(Geo|Je)ff(rey|ery)```等於```(Geo|Je)ff(re|er)y```
以上三種表達式等於接下來出現的這個=> ```Jeffrey|Geoffery|Jeffery|Geoffrey```
雖然比較長但也比較簡單！

```「^From\|Subject\|Date: 」vs.「^(From|Subject|Date): 」```
* 「^From\|Subject\|Date: 」:匹配「^From」、「Subject」或「Date: 」
* 「^(From|Subject|Date): 」:匹配行首，接著匹配「From」、「Subject」或「Date」三者之一，接著匹配「: 」
文言版解釋：
  1) 行首，跟著F．r．o．m，跟著": " ，或是
  2) 行首，跟著S．u．b．j．e．c．t，跟著": "，或是
  3) 行首，跟著D．a．t．e，跟著": "
白話版解釋：
  匹配行首開頭是「From: 」、「Subject: 」或「Date: 」的行。

以下範例：
```bash
egrep '^(From|Subject|Date): ' mailbox
From: ele@ta.org
Subject: be seenin...
Date: Mon, 23 Oct ...
```

### 忽視大小寫差異 -i
egrep的命令列選項```"-i"```能告訴它進行不區分大小寫的比對，如：
```bash
egrep -i '^(From|Subject|Date): ' mailbox
```
如此一來，連"SUBJECT: MAKE MONEY FAST..."等內容都可以匹配到

### 單詞邊界
註：並不是所有egrep版本都支援單詞邊界
單詞邊界可以幫助我們在一個句子中找到我們要的詞。
如果版本有支援的話就可以使用**詮釋序列(metasequences)**「\<」與「\>」。
```<cat>```
解釋：假如可以找到單詞的開始位置，後面緊接著cat，後面再緊接著單詞結束位置的話，就匹配。
白話版：找到cat這個單詞。

### 整理小結

| 詮釋字元 | 名稱 | 匹配內容 |
|---|---|---|
| . | 句點 | 任何一個字元 |
| \[...\] | 字元類別 | 任何一個列出的字元 |
| \[^...\] | 反轉字元類別 | 任何一個沒有列出的字元 |
| ^ | 脫字號 | 行首位置 |
| $ | 錢號 | 行尾位置 |
| \\< | 反斜線、小於 | 單字的開始位置(某些egrep版本不支援) |
| \\> | 反斜線、大於 | 單字的結束位置(某些egrep版本不支援) |
| \| | 或，bar | 匹配由它分隔的任一表達式 |
| (...) | 括號 | 用來限制「\|」的範圍，以及一些之後會提到的功能 |

### 可以省略的項目 colou?r
* ? (問號，question mark)為詮釋字元，只對緊鄰它前面的項目有效

```(July|Jul) (fourth|4th|4)```
上面是匹配七月四日的寫法，七月可能是July或Jul，四日可能是fourth、4th或4
以上的表達式可以使用「?」達到省略效果，以下表達式和上面表達式意義是相同的。
```(July?) (fourth|4th|4)```
沒有\|後代表括號部分不需要，也可省略，即等於
```July? (fourth|4th|4)```
如果?被放在括號()外，括號()的內容會被視為一個單位，即等於
```July? (fourth|4(th)?)```

### 其他量詞：反覆出現 「+」、「*」
* \+ 詮釋字元。代表“緊鄰前面的項目出現**一次**或**多次**” ```至少一定要出現一次！```
* \* 詮釋字元。代表“緊鄰前面的項目出現**任何次數**，包含**不出現**”

> 「?」、「+」、「*」都代表量詞(quantifiers)，因為它們會影響掌管範圍的出現次數

| | 至少需要 | 最多嘗試 | 意義 |
|---|---|---|---|
| ? | 無 | 1 | 允許一個；不必要("一個可省略的") |
| * | 無 | 不限 | 允許無限多個；不必要("任何數量皆可") |
| + | 1 | 不限 | 允許無限多個；需要一個("至少一個")

### 定義匹配次數範圍 「...{ 下限, 上限 }」
* 範例：```[a-zA-Z]{1,5}```
  * 1~5個英文字母(大小寫不限)

